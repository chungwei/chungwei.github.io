<!DOCTYPE html>
<html lang="en">
<head prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# website: http://ogp.me/ns/website#">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <meta name="description" content="">
    <meta property="og:title" content="Git 使用笔记">
    
    <meta property="og:type" content="article">
    <meta property="article:published_time" content="2016-05-14">
    
    <meta property="og:description" content="">
    <meta property="og:url" content="http://chungwei.github.io/2016/05/14/git/">
    <meta property="og:site_name" content="">
    
    <meta property="og:tags" content="git">
    
    <meta name="generator" content="Hugo 0.15" />
    <title>Git 使用笔记 &middot; </title>
    
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css">
    
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.7/styles/default.min.css">
    
    <link rel="stylesheet" href="http://chungwei.github.io/css/style.css">
    <link href="" rel="alternate" type="application/rss+xml" title="" />

    
    
</head>
<body>
<nav class="navbar navbar-default navbar-fixed-top visible-xs">
	<div class="container-fluid">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			
				<a class="navbar-brand" href="http://chungwei.github.io/">酒肉穿肠过</a>
			
		</div>
		<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
			<ul class="nav navbar-nav">
				
				
					<li><a href="http://chungwei.github.io/about">关于我</a></li>
				
					<li><a href="http://chungwei.github.io/">主页</a></li>
				
			</ul>
		</div>
	</div>
</nav>
<div class="container-fluid">
	<div class="row">
		<div id="menu" class="hidden-xs col-sm-4 col-md-3">
	<div id="menu-content" class="vertical-align">
		
			<h2 class="text-center"><a href="http://chungwei.github.io/">酒肉穿肠过</a></h2>
		
		
		
			<small class="text-center center-block">PHPer，Gopher</small>
		
		
		
			<img id="profile-pic" src="http://chungwei.github.io//img/profile.png" alt="My Picture" class="img-circle center-block">
		
		<div id="social" class="text-center">
			
			
			<a href="https://github.com/chungwei"><i class="fa fa-github fa-2x"></i></a>
			<a href="mailto:wei.chungwei@gmail.com"><i class="fa fa-envelope-o fa-2x"></i></a>
		</div>
		<div id="links" class="text-center">
			
			
				<a href="http://chungwei.github.io/about">关于我</a>
			
				<a href="http://chungwei.github.io/">主页</a>
			
		</div>
	</div>
</div>
		<div id="content" class="col-xs-12 col-sm-8 col-md-9">
			<div class="row">
				<div id="post" class="col-sm-offset-1 col-sm-11 col-md-11 col-lg-10">

<main>
	<header>
        <br>
        
		<h1 style="margin-top: 4px;">
            Git 使用笔记
        </h1>
	</header>

	<article>
        
            <small class="text-muted">
                
                
                    <a href="http://chungwei.github.io/tags/git">
                        <span class="label label-success">git</span>
                    </a>
                
            </small>
        

		

<p>关于<code>Git</code>的介绍实在太多，Google 或 百度一下 就有，不再介绍。</p>

<p>个人接触 <code>Git</code> 已经差不多三年，第一次使用<code>Git</code>作为版本管理工具时，网上查查资料也能使用，
但习惯了<code>Svn</code>的客户端，感觉学习<code>Git</code>的曲线很陡，很多命令总是很容易搞混或忘记，
后来换工作又切回<code>Svn</code>了。直到最近加到新的Team，完全使用<code>Git</code>，经过不断请教和学习，
该把成果整理归纳一下，以备今后查询。</p>

<hr />

<h4 id="基本操作命令:1c1ef82aae62aeea8eedcb5f455b129b">基本操作命令</h4>

<ol>
<li><p><strong>仓库初始化</strong><br />
个人认为实际用到的不多，一般都是现有的代码仓库，直接克隆下来，里面就有<code>.git</code> 目录</p>

<pre><code>git init # 生成 .git 目录
git remote add origin git@github.com:my-name/proj.git # 本地和远程仓库关联
</code></pre></li>

<li><p><strong>获取远程仓库</strong></p>

<pre><code>git clone git@github.com:my-name/proj.git
</code></pre></li>

<li><p><strong>查看仓库状态</strong><br />
提交之前，先看一下本次 修改、删除、新增 了哪些文件</p>

<pre><code>git status
</code></pre></li>

<li><p><strong>查看变更前后的差异</strong></p>

<pre><code>git diff [/path/to/file]  # 可指定文件，展示工作区和最新提交之间的差异，commit之前建议使用
git diff --stat  # 展示工作区和最新提交之间的差异，只有文件名和行数
git diff HEAD  # 比较本次提交和上次提交之间的差异，push之前建议使用
git diff 2265d4a86 4b94416057 # 比较两个历史版本之间的差异
</code></pre></li>

<li><p><strong>提交文件</strong><br />
提交仓库的变更，新增和修改文件命令相同</p>

<pre><code>git add /path/to/file1 [/path/to/file2...]  # 提交到本地暂存区，可同时提交多个文件
git commit -m '提交文件'  # 保存暂存区的变更到当前分支
git push origin branch-name  # 把变更文件推到当前分支对应的远程仓库
</code></pre>

<p>提交所有文件，可以使用</p>

<pre><code>git add -A
git commit -m '提交所有文件'
</code></pre>

<p>或简写为</p>

<pre><code>git commit -am '简写:提交所有文件'
</code></pre>

<p>如提交之后，想修改最近一次提交信息，可使用</p>

<pre><code>git commit --amend
</code></pre></li>

<li><p><strong>文件重命名或移动</strong></p>

<pre><code>git mv /path/to/old-file /path/to/new-file
git commit -m '文件重命名'
git push origin branch-name
</code></pre></li>

<li><p><strong>删除文件</strong></p>

<pre><code>git rm /path/to/file
git commit -m '删除文件'
git push origin branch-name
</code></pre></li>

<li><p><strong>查看提交记录</strong><br />
log 会已提交时间由近及远展示（不能看已删除的 commit log）</p>

<pre><code>git log # 展示提交的哈希值、合并信息、作者、提交时间和备注信息
git log /path/to/file # 展示指定文件/目录提交的哈希值、合并信息、作者、提交时间和备注信息
git log --pretty=short # 展示提交的哈希值、合并信息、作者和备注信息的第一行
git log --pretty=online # 一行展示提交的哈希值、备注信息
git log --graph # 简单图形展示每次提交的分支及其分化衍合情况
git log -p [/path/to/file] # -p 会展示前后差异
git log --stat # 展示每次提交新增或删除的文件行数
git log --grep=test # 展示包含test关键字的提交
git log --author=myname # 展示作者是myname的提交
</code></pre>

<p>那么，有时想查看包括已删除在内的所有commit log，则使用</p>

<pre><code>git reflog
</code></pre></li>

<li><p><strong>查看分支</strong></p>

<pre><code>git branch # 查看本地分支
git branch -r # 查看远程分支
git branch -a # 查看所有分支
</code></pre></li>

<li><p><strong>新建分支</strong></p>

<pre><code>git branch new-branch-1 # 新建分支
git checkout new-branch-1 # 切换新分支
git checkout master # 切换回到master
</code></pre>

<p>可简写为</p>

<pre><code>git checkout -b new-branch-1
</code></pre>

<p>使用以下命令即可把本地分支推送到远程</p>

<pre><code>git push origin new-branch-1
</code></pre></li>

<li><p><strong>分支重命名</strong></p>

<pre><code>git branch -m old-branch-name new-branch-name
git branch -M old-branch-name new-branch-name # 如已存在则强行覆盖
</code></pre>

<p>推送到远程，</p>

<pre><code>git push origin new-branch-name
</code></pre>

<p>此时，远程同时存在两个分支 <code>old-branch-name</code> 和 <code>new-branch-name</code></p></li>

<li><p><strong>删除分支</strong></p>

<pre><code>git checkout master # 不能删除当前所在分支
git branch -d old-branch-name # 删除本地分支，如有未合并的代码，将会删除失败
git branch -D old-branch-name # 强行删除，即使有未合并的代码
git push origin --delete old-branch-name # 删除远程分支
git push origin :old-branch-name # 把空推送到远程，也相当于删除远程分支
</code></pre></li>

<li><p><strong>本地分支推送至远程仓库</strong><br />
在推送之前，首先要确保本地已经跟远程仓库关联 <code>参看步骤1</code>，再推送</p>

<pre><code>git push origin new-branch-1
</code></pre></li>

<li><p><strong>获取远程分支</strong><br />
建议本地和远程分支的名称保持一致</p>

<pre><code>git checkout -b new-branch-2 origin/new-branch-2
</code></pre>

<p>将远程分支的最新代码同步到本地</p>

<pre><code>git pull origin new-branch-2 # 会自动merge  
# 等同于如下命令，注意git pull 和 git fetch 的区别
git fetch origin
git merge origin/new-branch-2
</code></pre></li>

<li><p><strong>分支合并</strong></p>

<pre><code>git checkout master
git merge --no-ff new-branch-1 # --no-ff 会把本次合并记录到历史记录中
git branch --merged # 查看已合并的分支
git branch --no-merged # 查看未合并的分支
</code></pre></li>

<li><p><strong>冲突解决</strong><br />
当发生冲突时，打开冲突文件编辑，再参考 <code>步骤5</code> 提交即可</p></li>

<li><p><strong>撤销修改</strong><br />
在提交到暂存区之前，需撤销某个文件的修改，则使用</p>

<pre><code>git checkout -- filename
</code></pre>

<p>如已经提交到暂存区，但未commit，则使用</p>

<pre><code>git reset HEAD filename
git checkout -- filename
</code></pre>

<p>还有一种情况，就是恢复已删除的文件</p>

<pre><code>rm filename # 发现误删了
git checkout -- filename # 即可恢复
</code></pre></li>

<li><p><strong>版本回退</strong><br />
<code>--hard</code>表示彻底回退</p>

<pre><code>git reset --hard HEAD~1 # 本地回退到上一个历史版本
git reset --hard 3b40bcb448c5b3 # 本地回到指定版本，可以是当前版本之前或之后的某一个版本
git reset --hard origin/master # 本地版本回到跟远程一样
</code></pre></li>

<li><p><strong>查看远程库信息</strong></p>

<pre><code>git remote -v
git remote show origin # 查看某个远程仓库的详细信息
</code></pre></li>

<li><p><strong>暂存变更信息</strong><br />
开发过程中，难免遇到紧急插入的需求，不得不停下手头去处理问题，这时候就需要保留现场（包括
暂存区和工作区的内容），可使用如下命令</p>

<pre><code>git stash # 对当前的暂存区和工作区状态进行保存
git stash list # 查看保存的现场
git stash pop # 恢复保存的现场并删除现场快照
</code></pre></li>

<li><p><strong>忽略文件和目录</strong><br />
一些文件不想提交，可配置为忽略，在根目录下的文件<code>.gitignore</code> 加入要忽略的文件和目录即可。</p></li>
</ol>

<hr />

<h4 id="举个栗子:1c1ef82aae62aeea8eedcb5f455b129b">举个栗子</h4>

<p>在实际的使用过程中，很多Team 一般使用 Github、Gitlab、Bitbucket等进行管理。下面以 <code>Github</code>为例。</p>

<p>现在<code>Github</code> 上已有项目 <code>test_proj</code>，地址为 <code>git@github.com:my-org/test_proj.git</code></p>

<blockquote>
<p><small>项目名称都是虚构</small></p>
</blockquote>

<ul>
<li><p>首先，在 <code>Github</code>上<code>fork</code>这个项目，完成之后你的开发分支就变成
<code>git@github.com:your-name/test_proj.git</code>。</p></li>

<li><p>将自己的开发分支克隆到本地</p>

<pre><code>git clone git@github.com:your-name/test_proj.git # 克隆项目
cd test_proj/
git remote add upstream git@github.com:my-org/test_proj.git # 很关键，设置个人分支的源仓库
</code></pre></li>

<li><p>在本地开发，期间的新增、修改、删除源文件以及提交等操作（参考<code>基本操作命令</code>即可），
都不会对源仓库有影响。</p></li>

<li><p>开发完成并通过测试之后，代码需合入源仓库，提个 <code>Pull Request</code>（简称<code>PR</code>），就可以等待项目的
owner 进行代码审查和合并了。</p></li>

<li><p>实际开发过程中，很可能是多人协作，每个人都<code>fork</code>自己的分支，提<code>PR</code>也有先后顺序，也许我们提<code>PR</code>
时，源仓库的代码已经经过了几次迭代，那么发生冲突的可能性就非常大。<br />
为了尽可能避免代码冲突，<code>设置个人分支的源仓库</code> 这个步骤就显得非常关键了，我们要在设置好源仓库之后，
在开发过程中，经常同步源仓库的代码，使用如下命令即可</p>

<pre><code>git pull upstream master # 同步master的最新代码到本地
</code></pre></li>
</ul>

<p>目前团队使用的这种模式，这也跟开源项目的模式是一致的，我个人也非常喜欢，省事！</p>

<p>之前使用 <code>Git-flow</code>模式开发，每次开发都需要从<code>master</code>新建分支，<code>merge</code> 之后再删除分支，
每次需求来了就反复<code>新建分支，删除分支</code>。</p>

<hr />

<p>学习<code>Git</code> 确实曲线比<code>Svn</code>陡，查了不少资料，还专门买了两本书来啃，花了大半个月，累死我了！
不过确实非常有收获，也非常开心，周末没出门，宅家里两天写完这篇博客，算是一个小小的总结吧！^_^</p>

<hr />

<h4 id="参考文献:1c1ef82aae62aeea8eedcb5f455b129b">参考文献</h4>

<ol>
<li><a href="https://git-scm.com/book/zh/v1">《Pro Git》</a></li>
<li>《GitHub入门与实践》大塚弘记 (作者)</li>
</ol>

	</article>
</main>

<div id="bottom-nav" class="text-center center-block">
	
</div>






  
<div class="ds-thread" data-thread-key="" data-title="Git 使用笔记" data-url="http://chungwei.github.io/2016/05/14/git/"></div>



<script type="text/javascript">
    var duoshuoQuery = {short_name:"chungwei"};

    (function() {
     var ds = document.createElement('script');
     ds.type = 'text/javascript';ds.async = true;
     ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
     ds.charset = 'UTF-8';
     (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
     })();
</script>




						</div>
					</div>
				</div>
			</div>
		</div>
  </div>
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.2/js/bootstrap.min.js"></script>
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/topojson/1.6.9/topojson.min.js"></script>
  
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.7/highlight.min.js"></script>
  
  <script src="http://chungwei.github.io//js/App.js"></script>
  
</body>
</html>
